<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock List - PaperMarket</title>
    <script src="tailwindcss.js"></script>
    <style>
        body {
            background-color: #0f172a;
            color: #e2e8f0;
        }
    </style>
</head>
<body class="bg-slate-950">
    <div class="min-h-screen p-8">
        <div class="max-w-6xl mx-auto">
            <div class="mb-8">
                <h1 class="text-3xl font-bold text-slate-100 mb-2">All Stocks</h1>
                <p class="text-slate-400">Search and browse all available Indian stocks</p>
            </div>

            <!-- Search Section -->
            <div class="bg-slate-900 border border-slate-800 rounded-xl p-6 mb-8">
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="flex-1">
                        <label class="block text-sm font-medium text-slate-300 mb-2">Search Stocks</label>
                        <input 
                            type="text" 
                            id="search-input"
                            placeholder="Type stock name or symbol..." 
                            class="w-full px-4 py-3 bg-slate-950 border border-slate-800 rounded-lg text-slate-100 placeholder-slate-500 focus:outline-none focus:border-emerald-500 focus:ring-2 focus:ring-emerald-500/30 transition-colors"
                            onkeyup="filterStocks()"
                        >
                    </div>
                    <div class="flex items-end">
                        <button onclick="loadAllStocks()" class="px-6 py-3 bg-emerald-500 hover:bg-emerald-600 text-white font-semibold rounded-lg transition-colors flex items-center justify-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                            </svg>
                            Load All
                        </button>
                    </div>
                </div>
                <p class="text-sm text-slate-400 mt-3">
                    <span id="stock-count">0</span> stocks loaded
                </p>
            </div>

            <!-- Loading Indicator -->
            <div id="loading" class="hidden text-center py-8">
                <div class="inline-block">
                    <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-emerald-500"></div>
                    <p class="text-slate-300 mt-4">Loading stocks...</p>
                </div>
            </div>

            <!-- Stocks Table -->
            <div id="stocks-list" class="space-y-3">
                <div class="text-center py-12 text-slate-400">
                    <p>Click "Load All" to fetch available stocks</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let allStocks = [];
        let filteredStocks = [];

        async function loadAllStocks() {
            const loadingEl = document.getElementById('loading');
            const stocksListEl = document.getElementById('stocks-list');
            
            loadingEl.classList.remove('hidden');
            stocksListEl.innerHTML = '';

            try {
                allStocks = [];
                const uniqueStocks = new Map();

                // Primary Method: Yahoo Finance with popular search terms for comprehensive coverage
                console.log('Fetching stocks from Yahoo Finance...');
                
                const searchTerms = [
                    // Alphabets
                    'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M',
                    'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z',
                    // Numbers
                    '0', '1', '2', '3', '4', '5', '6', '7', '8', '9',
                    // Popular sectors
                    'bank', 'tech', 'pharma', 'auto', 'steel', 'power', 'telecom',
                    'infra', 'oil', 'gas', 'finance', 'energy', 'healthcare'
                ];

                let completed = 0;
                const total = searchTerms.length;

                for (const term of searchTerms) {
                    try {
                        const response = await fetch(`https://corsproxy.io/?https://query1.finance.yahoo.com/v1/finance/search?q=${term}&quotesCount=250&newsCount=0&listsCount=0&quotesQueryId=tss_match_phrase_query&region=IN`);
                        const data = await response.json();
                        
                        if (data.quotes && Array.isArray(data.quotes)) {
                            for (const quote of data.quotes) {
                                if (quote.symbol && quote.symbol.endsWith('.NS')) {
                                    const symbol = quote.symbol.replace('.NS', '');
                                    if (!uniqueStocks.has(symbol)) {
                                        uniqueStocks.set(symbol, {
                                            symbol: symbol,
                                            name: quote.longname || quote.shortname || symbol,
                                            exchange: 'NSE'
                                        });
                                    }
                                } else if (quote.symbol && quote.symbol.endsWith('.BO')) {
                                    const symbol = quote.symbol.replace('.BO', '');
                                    if (!uniqueStocks.has(symbol)) {
                                        uniqueStocks.set(symbol, {
                                            symbol: symbol,
                                            name: quote.longname || quote.shortname || symbol,
                                            exchange: 'BSE'
                                        });
                                    }
                                }
                            }
                        }
                        completed++;
                        console.log(`Progress: ${completed}/${total} - Found ${uniqueStocks.size} stocks`);
                    } catch (e) {
                        console.log(`Skipped: ${term}`);
                        completed++;
                    }
                }

                allStocks = Array.from(uniqueStocks.values());
                allStocks.sort((a, b) => a.symbol.localeCompare(b.symbol));
                document.getElementById('stock-count').textContent = allStocks.length;
                filterStocks();

            } catch (error) {
                console.error('Error loading stocks:', error);
                stocksListEl.innerHTML = `
                    <div class="text-center py-8 text-rose-400">
                        <p>Error loading stocks. Please try again.</p>
                    </div>
                `;
            }

            loadingEl.classList.add('hidden');
        }

        function filterStocks() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            
            if (!searchTerm) {
                filteredStocks = [...allStocks];
            } else {
                filteredStocks = allStocks.filter(stock => 
                    stock.symbol.toLowerCase().includes(searchTerm) ||
                    stock.name.toLowerCase().includes(searchTerm)
                );
            }

            renderStocks();
        }

        function renderStocks() {
            const stocksListEl = document.getElementById('stocks-list');

            if (filteredStocks.length === 0) {
                stocksListEl.innerHTML = `
                    <div class="text-center py-12">
                        <svg class="w-16 h-16 mx-auto text-slate-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <p class="text-slate-400">${allStocks.length === 0 ? 'Click Load All to fetch stocks' : 'No stocks found'}</p>
                    </div>
                `;
                return;
            }

            stocksListEl.innerHTML = filteredStocks.map(stock => `
                <div class="bg-slate-900 border border-slate-800 hover:border-emerald-500/30 rounded-lg p-4 transition-all hover:shadow-lg hover:shadow-emerald-500/10">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-emerald-500/10 border border-emerald-500/20 rounded-full flex items-center justify-center">
                                    <span class="text-sm font-bold text-emerald-500">${stock.symbol.charAt(0)}</span>
                                </div>
                                <div>
                                    <p class="font-semibold text-slate-100">${stock.symbol}</p>
                                    <p class="text-sm text-slate-400">${stock.name}</p>
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-slate-800 text-slate-300">
                                ${stock.exchange}
                            </span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Initialize
        renderStocks();
    </script>
</body>
</html>
